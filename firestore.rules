rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Regras para a coleção 'users'
    match /users/{userId} {
      // Qualquer usuário autenticado pode ler perfis.
      allow read: if request.auth != null;

      // Um usuário pode criar seu próprio perfil.
      allow create: if request.auth.uid == userId;

      // Um usuário só pode atualizar seu próprio perfil.
      allow update: if request.auth.uid == userId;

      // Um usuário só pode deletar seu próprio perfil.
      allow delete: if request.auth.uid == userId;
    }

    // Regras para a coleção 'groups'
    match /groups/{groupId} {
      // Qualquer usuário autenticado pode ler os dados de um grupo.
      allow read: if request.auth != null;

      // Um gestor pode criar um grupo se ele for o manager.
      // O ID do gestor deve ser o mesmo que o ID do grupo.
      allow create: if request.auth.uid == groupId && request.resource.data.managerId == request.auth.uid;

      // Um gestor só pode atualizar seu próprio grupo.
      allow update: if request.auth.uid == resource.data.managerId;

      // Um gestor só pode deletar seu próprio grupo.
      allow delete: if request.auth.uid == resource.data.managerId;
    }
  }
}
